---
layout: article
title: 【Node.js】新人さん向けにバックエンドのレイヤーについて説明する
tags: Node.js
aside:
  toc: true
---

## この記事について

ウェブアプリケーションのアーキテクチャについて、
- 新人さん向けに
- なるべく簡潔に
- 説明しやすいところだけ

説明します。

## ウェブアプリケーションとは

ウェブをつかって作られたアプリケーションです。
Wikipediaにはこうかかれています。

>代表的なウェブアプリケーションでは、WebブラウザがHTTPを利用してHTMLを取得・表示、それをDOMを介してJavaScriptが操作し、必要に応じてWebサーバと通信をおこなってデータを更新する。このようにウェブ（World Wide Web）を基盤として作られる応用ソフトウェアをウェブアプリケーション（Webアプリ）と総称する。


## どんな仕組みなのか

例えばTODOアプリを使おうとしたとき、以下のような操作ができると思います。

- TODOを見る
- TODOを追加する
- TODOを編集する
- TODOを削除する

こういった操作ができるウェブアプリケーションを作ろうとしたら、だいたい以下の役割にわけて作り始めます。

- ユーザーインターフェース
- データベース
- API

### ユーザーインターフェースとは

>機械、特にコンピュータとその機械の利用者（通常は人間）の間での情報をやりとりするためのインタフェースである。
By wiki

つまりスマホやパソコンを使う私たち人間と、SNSなどのアプリケーションサービスとの間に入るインターフェース（接点）です。

例えばヤフーを開いたときに表示されるニュース一覧や、メルカリで気に入った商品を購入する際のボタンなど。
機械を触っていて目にするものはだいたい「ユーザーインターフェース」と言えます。
デザインセンスが問われたりします。

![image](https://user-images.githubusercontent.com/44778704/154482411-2a05721b-6f54-442e-8e6e-d4eac362dedd.png)

### データベースとは
>データベース（英: database, DB）とは、検索や蓄積が容易にできるよう整理された情報の集まり。
by Wikipedia

そのまんまです。
例えばあるサービスの会員登録をした際、入力したメールアドレスやパスワードはこの「データベース」に保存しています。

例えば学校に関わるデータベースがあったとしたら、そこにはきっと生徒のデータが入っていると思います。

- 出席番号: 1
- 苗字: かまど
- 名前: たんじろう
- 年齢: 10

きっとこんな感じ。
エクセルやグーグルスプレッドシートにザーッとかかれた情報のように、きれいに整頓されたデータ群をイメージしてください。

![image](https://user-images.githubusercontent.com/44778704/154483305-6ab07716-3d1c-4c5a-939d-5fb3b533d479.png)



### API(アプリケーションプログラムインターフェース)とは

>ソフトウェアコンポーネント同士が互いに情報をやりとりするのに使用するインタフェースの仕様である。
By Wikipedia

うーん難しい・・
開発の現場で「API」という言葉が出てきたら、それはユーザーインターフェースとデータベースを結ぶものです。
例えばTwitterで何か一言つぶやいたら、その一言はユーザーインターフェースからAPIを通じてデータベースに保存されます。
そして自分以外の人がTwitterを開いたら、APIがデータベースからとってきたあなたのつぶやきが画面に表示されています。

![image](https://user-images.githubusercontent.com/44778704/154272049-8478e5e8-0096-4d5d-8804-30e21ebb902d.png)


### 補足: フロントエンドとバックエンド
ウェブアプリケーション開発では、フロントエンドエンジニアとかバックエンドエンジニアという言い方で役割をわけたりします。
フロントエンド担当者は、ユーザーインターフェースなど見た目の部分）を開発し、バックエンド担当者はAPIやデータベースまわりなど、見た目には隠れている部分を開発します。

![image](https://user-images.githubusercontent.com/44778704/154487866-210b4c79-310b-4a2b-b768-f68be9a256ce.png)

## APIのアーキテクチャ

APIについてもうすこし掘り下げます。

APIは通常、ユーザーインターフェースから要求をうけて、必要な結果を返却するという役目をもっています。
前章の例の繰り返しになりますが、たとえばyahooのようなニュースサイトにアクセスしたら・・

1. ユーザーがニュースサイトにアクセスする
2. 画面はニュース一覧をAPIに要求する
3. APIはデータベースからニュース一覧をとってきて画面に渡す
4. 画面はニュース一覧を表示する


みたいな流れで必要な情報を画面に投げ返しています。
(yahooの実際の処理は違うかもしれません。あくまでも処理の流れの例です。)

APIの中でもさらに細かく役割分担がわかれています。
大きくわけて以下の3ステップがあり、
以下の1 -> 2 -> 3 -> 2 -> 1 という感じで3までいってデータを取ってきたら1のほうへ逆走しています。

1. コントローラー: GETやPOSTされた要求を受け取り、サービスに投げ、サービスから戻ってきたデータを返却する
2. サービス: 後述のリポジトリを通じて取得したデータを精査して、必要であれば付加情報などを付け加え、コントローラーに返却する
3. リポジトリ: データベースからデータをとってきたり書き込んだりして、その結果をサービスに返却する。


![image](https://user-images.githubusercontent.com/44778704/154280361-ce81893e-096d-442d-b91d-e5a0b2ce5092.png)


を作ろうとしたとき、入門書をみるとどれも1枚のファイルで受け取りから返却まで完了していることがああります。

これでもアプリケーションはなりたちますが、情報が増えてくると1つのファイルですべての処理を書くとソースが長くなり読み辛くなるし、複数の人と協力して開発するのが難しくなってきます。

役割に応じてファイルを分けることでメンテナンスがしやすいプロジェクトになります。

この役割分担を「レイヤーを分ける」という言い方をしたりします。

## レイヤーごとの役割


それぞれのレイヤーではどんな仕事をしているのかもう少し詳しく解説します。

### コントローラー

画面からの要求を受け付けます。
APIは要求ごとに「URL」と「HTTPメソッド」を組み合わせてリクエストを聞き入れます。w

- URL: /newsや/usersなど、情報のグループ名をつけることが多いです。

- HTTPメソッド: 主にいかがあります
  - GET: 情報の取得
  - POST: 情報の追加
  - PUT: 情報の更新
  - DELETE: 情報の削除

たとえばニュース一覧を取得したければ、
```
GET https://xxxx.com/news
```
というリクエストを投げます。

そのほかも、
```
POST https://xxx.com/news
PUT https://xxx.com/news/:id
DELETE https://xxx.com/news/:id
```
このようなリクエストを投げることで、APIに操作を要求しています。


