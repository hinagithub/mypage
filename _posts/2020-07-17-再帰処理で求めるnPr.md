---
layout: article
title: 再帰処理で求めるnPr
tags: JavaScript
aside:
  toc: true
---

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

# この記事について

難易度の高いプログラミングクイズを解くにあたり、避けて通れないのが再帰処理でした。
そのなかでも「順列」は特に使いこなせるようになりたかったので記事にまとめました。

以下の説明をしています。

-   順列とは何か
-   再帰処理とは何か
-   順列を出力するサンプルプログラム

以下は説明しません。
- [公式(nPr)を使った順列パターン数の算出方法]()

# 順列とは何か
そもそも順列ってなんでしたっけ。<br>

## 結論

順列(nPr)は、「n個の物の中からr個を取り出して一列に並べたもの」です。<br>
`nPr`の`P`は`permutation`の略で、そのまま「順列」という意味です。<br>
例えば3匹の動物から2匹を取り出して一列に並べると、以下のような順列になります。

![image](https://user-images.githubusercontent.com/44778704/87756385-ce6f8300-c843-11ea-8315-1d6f5ba5e241.png)

## nCr との違いに注意

注意しなければならないのは、`「1:ねずみ」「2:うし」`と`「1:うし」「2:ねずみ」`は**異なるもの**だという点です。<br>

![image](https://user-images.githubusercontent.com/44778704/87757215-3d011080-c845-11ea-8f8a-fbdd8010266b.png)

上記を「同じ」とみなす考え方は「組み合わせ(`nCr`)」といいます。<br>
この2つはよく混同されますが**別物**なので気をつけてください。<br>

nCrについては以下の記事がわかりやすかったです。

[５分で分かる！確率統計「nCr」の計算方法](https://blog.apar.jp/data-analysis/3927/)
## 順列の洗い出し方

どのように並べれば順列を取得のか、例を上げて解説します。

### <img src ="https://latex.codecogs.com/gif.latex?\inline&space;\LARGE&space;_{4}P_{2}" />の例

4匹の動物[ねずみ][うし][とら][うさぎ]から2匹選んで並べるとき、以下の手順で並べるとパターンを網羅できます。

1. [ねずみ]と[それ以外の動物]をそれぞれ組み合わせる
2. [うし]と[それ以外の動物]をそれぞれ組み合わせる
3. [とら]と[それ以外の動物]をそれぞれ組み合わせる
4. [うさぎ]と[それ以外の動物]をそれぞれ組み合わせる

  ```md

  🐭
  - [ねずみ]と
      - [うし]
      - [とら]
      - [うさぎ]

  🐮
  - [うし]と
      - [ねずみ]
      - [とら]
      - [うさぎ]

  🐯
  - [とら]と
      - [ねずみ]
      - [うし]
      - [うさぎ]

  🐰
  - [うさぎ]と
      - [ねずみ]
      - [うし]
      - [とら]
```

4匹の動物それぞれに対して3匹ずつ組み合わせられるので `4 × 3 = 12 通り` の順列ができあがります。


### <img src ="https://latex.codecogs.com/gif.latex?\inline&space;\LARGE&space;_{4}P_{3}" />の例

4匹の動物[ねずみ][うし][とら][うさぎ]から3匹選んで並べるとき、以下の手順で並べるとパターンを網羅できます。

1. [ねずみ]と[うし]と[それ以外の動物]をそれぞれ組み合わせる
2. [ねずみ]と[とら]と[それ以外の動物]をそれぞれ組み合わせる
3. [ねずみ]と[うさぎ]]と[それ以外の動物]をそれぞれ組み合わせる
4. [うし]と[ねずみ]と[それ以外の動物]をそれぞれ組み合わせる
5. [うし]と[とら]と[それ以外の動物]をそれぞれ組み合わせる
6. [うし]と[うさぎ]]と[それ以外の動物]をそれぞれ組み合わせる
7. [とら]と[ねずみ]と[それ以外の動物]をそれぞれ組み合わせる
8. [とら]と[うし]と[それ以外の動物]をそれぞれ組み合わせる
9. [とら]と[うさぎ]]と[それ以外の動物]をそれぞれ組み合わせる
10. [うさぎ]と[ねずみ]と[それ以外の動物]をそれぞれ組み合わせる
11. [うさぎ]と[うし]と[それ以外の動物]をそれぞれ組み合わせる
12. [うさぎ]と[とら]と[それ以外の動物]をそれぞれ組み合わせる


  ```md

  🐭
  - [ねずみ]と
      - [うし]と
          - [とら]
          - [うさぎ]
      - [とら]と
          - [うし]
          - [うさぎ]
      - [うさぎ]と
          - [うし]
          - [とら]

  🐮
  - [うし]と
      - [ねずみ]と
          - [とら]
          - [うさぎ]
      - [とら]と
          - [ねずみ]
          - [うさぎ]
      - [うさぎ]と
          - [ねずみ]
          - [とら]

  🐯
  - [とら]と
      - [ねずみ]と
          - [うし]
          - [うさぎ]
      - [うし]と
          - [ねずみ]
          - [うさぎ]
      - [うさぎ]と
          - [ねずみ]
          - [うし]

  🐰
  - [うさぎ]と
      - [ねずみ]と
          - [うし]
          - [とら]
      - [うし]と
          - [ねずみ]
          - [とら]
      - [とら]と
          - [ねずみ]
          - [うし]
```

4匹の動物それぞれに対して3匹ずつ組み合わせられ、さらにそこから2匹ずつ組み合わせが可能です。<br>
よって `4 × 3 × 2 = 24通り` の順列になるはずです。

### 余談: 順列の並べ方の総数

上記で説明したように、順列は並べる数('r')が増えれば増えるほどパターンの総数も倍々に増えていきます。<br>
その総数を知りたい場合は「nのr回分の階乗」を求めればOKです。<br>
`階乗`はその数から1ずつ引いた数を掛け合わせた数のことで、たとえば`5の階乗`は`5*4*3*2*1`です。<br>
<br>
いくつか例をみるとわかりやすいと思います。

- 5種類から3つ選んで並べる(5の3回分の階乗)<br>
<img src= "https://latex.codecogs.com/gif.latex?\LARGE&space;_{5}P_{3}=5\times&space;4&space;\times3&space;" /><br>

- 6種類から4つ選んで並べる(6の4回分の階乗)<br>
<img src= "https://latex.codecogs.com/gif.latex?\LARGE&space;_{6}P_{4}=&space;6&space;\times&space;5&space;\times&space;4&space;\times&space;3" /><br>

- 5種類から1つ選んで並べる(5の1回分の階乗)<br>
<img src= "https://latex.codecogs.com/gif.latex?\LARGE&space;_{5}P_{1}=&space;5" /><br>

- 3種類から3つ選んで並べる(3の3回分の階乗)<br>
<img src= "https://latex.codecogs.com/gif.latex?\LARGE&space;_{3}P_{3}=&space;3&space;\times2&space;\times&space;1" /><br>

きちんとした公式を使って求める方法もありますが、それは話が逸れるので別の記事にまとめました。
[順列(nPr)の総数を求める]()


### プログラムサンプル

紹介した順列の数式をもとにコードを書いてみます。

```js
const permutation = (n, r) => {
  const result = [];

  // 文字数チェック
  if (n.length < r) return [];

  // r が 1 なら
  if (r === 1) {
    for (let i = 0; i < n.length; i++) {
      result[i] = [n[i]];
    }
    return result;
  }
  for (let i = 0; i < n.length; i++) {
    const parts = n.slice(0);
    parts.splice(i, 1)[0];
    let row = permutation(parts, r - 1);
    for (let j = 0; j < row.length; j++) {
      result.push([n[i]].concat(row[j]));
      console.log([n[i]].concat(row[j]));
    }
  }

  return result;
};

let arr = permutation([""], 1);
console.log(JSON.stringify(arr));
// [["a","b"],["a","c"],["b","a"],["b","c"],["c","a"],["c","b"]]
```

# 参考

-   「nCr」についての記事ですが、お寿司で解説してるのがとてもわかりやすかったので参考にしました🍣<br>
    [５分で分かる！確率統計「nCr」の計算方法](https://blog.apar.jp/data-analysis/3927/)

-   ソースコードはこちらを参考にしました<br>
    [順列・組み合わせ のサンプルコード JS \[permutation\] \[combination\]](https://tech-blog.s-yoshiki.com/entry/144#%E9%A0%86%E5%88%97---permutation)
