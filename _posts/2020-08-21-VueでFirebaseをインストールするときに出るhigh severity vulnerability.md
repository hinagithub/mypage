---
layout: article
title: VueでFirebaseをインストールするときに出るhigh severity vulnerability
tags: Vue.js Firebase
aside:
  toc: true
---

## 概要
Vueプロジェクトで`npm i firebase`したときに出る脆弱性レポートの解消方法をまとめます。

## 環境:
- @vue/cli 4.5.4
- Vue.js 3.x


## レポート1

Vue CLIでプロジェクトを作成

```
vue create プロジェクト名
```

設定項目
![image](https://user-images.githubusercontent.com/44778704/90856496-02971000-e3bd-11ea-8b0f-93184687d7d4.png)


```
cd プロジェクト名
npm install firebase
```

脆弱性のレポートが出る

```
found 1 high severity vulnerability
  run `npm audit fix` to fix them, or `npm audit` for details
himac:auth hinako$ npm audit
```
auditすると・・・
```
npm audit fix
```
エラーになる
```
npm ERR! code ELOCKVERIFY
npm ERR! Errors were found in your package-lock.json, run  npm install  to fix them.
npm ERR!     Missing: core-js@^3.6.5
```

以下を実行して解決
```
npm install --save core-js
```

参考:
[Vue.js×firebaseでアプリを作ってるときにfirebaseを入れたらエラーが起きた](https://qiita.com/Yui_active/items/6b21559c2940db04b0a6)



## レポート2

すると今度はserialize-javascriptで脆弱性レポートが出る
```
┌───────────────┬──────────────────────────────────────────────────────────────┐
│ High          │ Remote Code Execution                                        │
├───────────────┼──────────────────────────────────────────────────────────────┤
│ Package       │ serialize-javascript                                         │
├───────────────┼──────────────────────────────────────────────────────────────┤
│ Patched in    │ >=3.1.0                                                      │
├───────────────┼──────────────────────────────────────────────────────────────┤
│ Dependency of │ @vue/cli-service [dev]                                       │
├───────────────┼──────────────────────────────────────────────────────────────┤
│ Path          │ @vue/cli-service > copy-webpack-plugin >                     │
│               │ serialize-javascript                                         │
├───────────────┼──────────────────────────────────────────────────────────────┤
│ More info     │ https://npmjs.com/advisories/1548                            │
└───────────────┴──────────────────────────────────────────────────────────────┘
```

`npm audit fix`してもダメ。<br/>
ググってISSUEを発見。この問題はまだ解決されていないらしい。

[High vulnerability in dependencies -> copy webpack plugin -> serialize js #5782](https://github.com/vuejs/vue-cli/issues/5782)

このISSUEでオススメされているとおり、いったん`npm-force-resolutions`でバージョン強制固定することに。<br/>

package.jsonにresolutionsを追加

```json
// package.json
  "scripts": {
    // 略
  },
  "resolutions": {
    "serialize-javascript": "4.0.0"
  },
```

もういっかいインストール

```
yarn install

```
6.0が無いから選べと言われるので4.0(最新)を選択
![image](https://user-images.githubusercontent.com/44778704/90860608-442bb900-e3c5-11ea-883d-5bddaf1b1ad7.png)

強制固定を実行

```
npx npm-force-resolutions

→npx: 5個のパッケージを3.737秒でインストールしました。
```

確認
```
npm audit
```
→ `found 0 vulnerabilities`になったらOK

参考:
[既存のnpmパッケージの依存関係を強制的に固定したいときはnpm-force-resolutionsが使える](https://scrapbox.io/nwtgck/%E6%97%A2%E5%AD%98%E3%81%AEnpm%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E4%BE%9D%E5%AD%98%E9%96%A2%E4%BF%82%E3%82%92%E5%BC%B7%E5%88%B6%E7%9A%84%E3%81%AB%E5%9B%BA%E5%AE%9A%E3%81%97%E3%81%9F%E3%81%84%E3%81%A8%E3%81%8D%E3%81%AFnpm-force-resolutions%E3%81%8C%E4%BD%BF%E3%81%88%E3%82%8B)


## 補足
最初はISSUEにあるとおり、`"serialize-javascript": "6.0.0"`にしてたけど、そんなバージョンはないと言われたので`4.0.0`にしました<br/>
レポートはちゃんと消えました。

以上
