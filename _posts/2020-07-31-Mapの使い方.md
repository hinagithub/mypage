---
layout: article
title: Mapの使い方
tags: JavaScript
aside:
  toc: true
---

# この記事について

Object配列ではなく、Mapを使った連想配列を使うことを意識しはじめました。
まだ使い慣れておらず、「こうしたいときどうするんだっけ？」となるたびに本を開き直しています。
本を開くのが面倒なので、メソッドや便利な使い方をQiitaにメモしておきます。

- 説明すること
  - Mapを使った連想配列の使い方

- 説明しないこと
  - そもそも配列とは何か
  - ArrayやObject配列との違い
    - 参考1: [MDN -Map-](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Map)
    - 参考2: [JavaScriptでObjectじゃなくMapを使う場面の一例](https://qiita.com/ikngtty/items/d9e1e8b1018ec766767c)
    - 参考3: [連想配列はMapを使うべきは本当か？](https://qiita.com/raccy/items/816a322fb330193e788b)


# 配列の初期化

宣言だけする

```js
const map = new Map()
```

宣言と同時に初期値を設定する

```js
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
]);
```

# メンバー

## 一覧

  | 名称 | 説明 |
  | :---: | :---: |
  | .size | 要素数を返す |
  | .has(key) | keyが一致する要素の有無を真偽値で取得します|
  | .get(key) | keyが一致する要素の値を取得します|
  | .set(key,value) | keyが一致する要素の値を上書き(または追加)します|
  | .clear() | すべての要素を削除します |
  | .delete(key) | keyが一致する要素を削除します |
  | .keys() | 全ての要素のkeyのみ取得します |
  | .values() | 全ての要素のvalueのみ取得します |
  | .entries() | 全ての要素のkeyとvalueをセットで取得します。 |
  | .forEach(callback[, thisArg]) | 引数 `callback`に渡した処理を要素それぞれの値に実行します |

## .size
要素数を返します。

```js
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
  ['理科', 55],
  ['地理', 60],
  ['歴史', 49],
]);

const size = testResults.size
// 6
```

*プロパティなのでカッコ`()`が不要です。
`size()`ではなく`size`と書きます。


## .has(key)
keyが一致する要素の有無を真偽値で取得します。

```js
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
]);

const hasEnglishResult = testResults.has('英語');
// true

const hasHistoryResult = testResults.has('歴史');
// false
```

## .get(key)
keyが一致する要素の値を取得します。
keyが一致する要素がなかった場合は`undifined`を取得します。

```js
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
]);

const englishResult = testResults.get('英語');
// 82

const historyResult = testResults.get('歴史');
// undefined
```

## .set(key,value)

keyが一致する要素の値を上書きします。
keyが一致する要素が存在しない場合、新たに要素を追加します。

```js
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
]);

// 上書き
testResults.set('英語', 100);
// Map {
//   '国語' => 77,
//   '数学' => 91,
//   '英語' => 100,
// }

// 追加
testResults.set('理科', 55);
// Map {
//   '国語' => 77,
//   '数学' => 91,
//   '英語' => 100,
//   '理科' => 55,
// }
```

## .clear
すべての要素を削除します。

```js
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
  ['理科', 55],
  ['地理', 60],
  ['歴史', 49],
]);

console.log(testResults.clear());
// Map {}
```

## .delete(key)
keyが一致する要素を削除します。
削除ができたかどうかを有無を真偽値で取得することもできます。

```js

const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
]);

console.log(testResults.delete('数学'));
// true
// Map {
//   '国語' => 77,
//   '英語' => 82,
// }

console.log(testResults.delete('理科'));
// false
// Map {
//   '国語' => 77,
//   '英語' => 82,
// }
```

## .keys()
全ての要素のkeyのみ取得します。

```js
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
]);

const keys = testResults.keys();
// [Map Iterator] {
//   '国語',
//   '数学',
//   '英語'
// }
```

*実行結果はシンボルという特殊な型で出力されます。
配列として扱う方法は次章「便利な使い方」で説明します。


## .values()

全ての要素のvalueのみ取得します。

```js
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
]);

const values = testResults.values();
// [Map Iterator] {
//   77,
//   91,
//   82
// }
```

*実行結果はシンボルという特殊な型で出力されます。
配列として扱う方法は次章「便利な使い方」で説明します。

## .entries()
全ての要素のkeyとvalueをセットで取得します。

```js
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
]);

const entries = testResults.entries();
// [Map Entries] {
//   ['国語', 77],
//   ['数学', 91],
//   ['英語', 82]
// }
```

*実行結果はシンボルという特殊な型で出力されます。
配列として扱う方法は次章「便利な使い方」で説明します。


## .forEach(callback[, thisArg])

引数 `callback`に渡した処理を要素それぞれの値に実行します。
Array.prototype.forEach()と同じような動きをします。

```js
// forEach()
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
]);

testResults.forEach((key, value, map) => {
  console.log(key, value, map);
});

// 77 国語 Map { '国語' => 77, '数学' => 91, '英語' => 82 }
// 91 数学 Map { '国語' => 77, '数学' => 91, '英語' => 82 }
// 82 英語 Map { '国語' => 77, '数学' => 91, '英語' => 82 }

```

# 便利な使い方

## Iteratorを配列として扱う

keys()やvalues()の実行結果はシンボルという特殊な型で出力されます。
- 参考1: [JavaScript互換性の要！Symbol（シンボル）について](https://analogic.jp/symbol/)
- 参考2: [ECMAScript6にシンボルができた理由](https://qiita.com/naruto/items/312adeb6145eb6221be7)


配列ではないので、配列用の関数を実行するとエラーになります。

```js
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
]);

const keys = testResults.keys();
keys.forEach((key) => console.log(key));
// TypeError: keys.forEach is not a function
```

### 解決策1 `Array.from()`を使う
配列として値を取得したい場合は、`Array.from()`を使って変換すればOKです。

```js
const keys = Array.from(testResults.keys());
keys.forEach((key) => console.log(key));
// 国語
// 数学
// 英語
```

### 解決策2 スプレッド構文([...配列])を使う
`[...Map.keys()]`とても解決できます。

```js
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
]);

const keys = [...testResults.keys()];
keys.forEach((key) => console.log(key));
// 国語;
// 数学;
// 英語;
```

## キーでソートする

数値のkeyを数の若い順に並び替えるコードです。
参考: [Stack Overflow -Is it possible to sort a ES6 map object?-](https://stackoverflow.com/questions/31158902/is-it-possible-to-sort-a-es6-map-object/31159284)


```js
const testResults = new Map([
  [6, '歴史'],
  [1, '国語'],
  [4, '理科'],
  [5, '地理'],
  [2, '数学'],
  [3, '英語'],
]);

const sortedTestResults = new Map(
  [...testResults.entries()].sort((a, b) => a[0] - b[0])
);
// Map {
//   1 => '国語',
//   2 => '数学',
//   3 => '英語',
//   4 => '理科',
//   5 => '地理',
//   6 => '歴史'
// }

```

## 最大値を取得する

値の中で最大の数値を取得するコードです。

```js
const testResults = new Map([
  ['国語', 77],
  ['数学', 91],
  ['英語', 82],
  ['理科', 55],
  ['地理', 60],
  ['歴史', 49],
]);

const maxNum = Math.max(...Array.from(testResults.values()));
// 91
```

## 重複する値の数をカウントする

配列内の同じ値の出現回数を要素ごとにカウントするコードです。

```js
const animals = ['ねこ', 'いぬ', 'とり', 'ねこ', 'とり', 'いぬ', 'いぬ'];
const animalCounts = new Map();

for (let animal of animals) {
  // 一致するkeyがあればカウントアップ
  if (animalCounts.has(animal)) {
    const count = animalCounts.get(animal);
    animalCounts.set(animal, count + 1);

  // 一致するkeyがなければ新たに値をset
  } else {
    animalCounts.set(animal, 1);
  }
}

console.log(animalCounts);
// Map {
//   'ねこ' => 2,
//   'いぬ' => 3,
//   'とり' => 2,
// }

```

## まとめ


